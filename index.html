<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulado Estruturado de Neurofisiologia</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Define a fonte Inter, se dispon√≠vel, para um visual moderno */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Customiza o scrollbar para melhor est√©tica */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background-color: #94a3b8;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0;
        }
        .time-up {
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 100% { background-color: #ef4444; }
            50% { background-color: #b91c1c; }
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen font-sans">

    <div id="root" class="max-w-6xl mx-auto p-4 sm:p-8">
        <div id="header-container"></div>
        <div id="results-summary"></div>
        <section id="closed-questions-section" class="space-y-10 mb-10"></section>
        <section id="open-questions-section" class="space-y-6"></section>
        <div id="footer-container"></div>
    </div>

    <script>
        // --- DEFINI√á√ÉO DOS TEMAS E POOLS DE QUEST√ïES BASEADAS NOS SLIDES DE NEUROFISIOLOGIA ---
        const FULL_POOLS = {
            'cat1': {
                nome: 'Controle Motor: Reflexos, N√∫cleos da Base e Cerebelo',
                cor: 'blue',
                fechadas: [
                    { id: 1, pergunta: 'Qual √© a fun√ß√£o principal do Fuso Muscular nos reflexos espinhais?', opcoes: ['Detectar tens√£o no tend√£o.', 'Detectar o comprimento e estiramento do m√∫sculo.', 'Inibir o neur√¥nio motor alfa.', 'Detectar est√≠mulos dolorosos na pele.'], correta: 1, tema: 'cat1' },
                    { id: 2, pergunta: 'No reflexo miot√°tico inverso, qual estrutura sensorial √© ativada para proteger o m√∫sculo de cargas excessivas?', opcoes: ['Fuso muscular.', 'Corp√∫sculo de Pacini.', '√ìrg√£o Tendinoso de Golgi (OTG).', 'Termina√ß√£o nervosa livre.'], correta: 2, tema: 'cat1' },
                    { id: 3, pergunta: 'Qual neurotransmissor √© liberado pela subst√¢ncia negra na via nigroestriatal, cuja degenera√ß√£o causa a Doen√ßa de Parkinson?', opcoes: ['Acetilcolina.', 'Glutamato.', 'GABA.', 'Dopamina.'], correta: 3, tema: 'cat1' },
                    { id: 4, pergunta: 'Qual das seguintes √© uma fun√ß√£o atribu√≠da aos N√∫cleos da Base?', opcoes: ['Execu√ß√£o direta da contra√ß√£o muscular.', 'Filtragem, in√≠cio e t√©rmino de movimentos volunt√°rios.', 'Coordena√ß√£o fina e corre√ß√£o de erros motores em tempo real.', 'Gera√ß√£o de reflexos medulares.'], correta: 1, tema: 'cat1' },
                    { id: 5, pergunta: 'Uma les√£o no Cerebelo resultaria tipicamente em qual dos seguintes sintomas?', opcoes: ['Paralisia fl√°cida.', 'Tremor de repouso.', 'Ataxia e dismetria (erro de alvo).', 'Perda de sensibilidade t√°til.'], correta: 2, tema: 'cat1' },
                    { id: 6, pergunta: 'Na organiza√ß√£o hier√°rquica motora, quem s√£o os "neur√¥nios motores inferiores"?', opcoes: ['Neur√¥nios do c√≥rtex motor.', 'Neur√¥nios do tronco encef√°lico.', 'Neur√¥nios da medula espinhal que inervam diretamente o m√∫sculo.', 'Neur√¥nios dos n√∫cleos da base.'], correta: 2, tema: 'cat1' },
                    { id: 7, pergunta: 'A via direta dos n√∫cleos da base tem qual efeito final sobre o c√≥rtex motor?', opcoes: ['Facilita√ß√£o (libera√ß√£o) do movimento.', 'Inibi√ß√£o do movimento.', 'Nenhum efeito.', 'Ativa√ß√£o do reflexo de retirada.'], correta: 0, tema: 'cat1' },
                    { id: 8, pergunta: 'O trato Corticoespinhal Lateral √© respons√°vel principalmente pelo controle de:', opcoes: ['M√∫sculos axiais e postura.', 'M√∫sculos distais (apendiculares) para movimentos volunt√°rios finos.', 'Reflexos auton√¥micos.', 'Movimentos oculares.'], correta: 1, tema: 'cat1' },
                    { id: 9, pergunta: 'Qual divis√£o funcional do cerebelo est√° mais associada ao equil√≠brio e movimentos oculares?', opcoes: ['Espinocerebelo.', 'Cerebrocerebelo.', 'Vestibulocerebelo (Floculonodular).', 'Verme cerebelar.'], correta: 2, tema: 'cat1' },
                    { id: 10, pergunta: 'A Doen√ßa de Huntington √© caracterizada por hipercinesia (movimentos excessivos). Isso ocorre devido √† perda de neur√¥nios na via:', opcoes: ['Direta.', 'Indireta.', 'Nigroestriatal dopamin√©rgica.', 'Cerebelar.'], correta: 1, tema: 'cat1' },
                ],
                abertas: [
                    { id: 1, pergunta: 'Diferencie o Reflexo Miot√°tico (de estiramento) do Reflexo Miot√°tico Inverso (tendinoso) em termos de est√≠mulo e resposta muscular.', gabarito: '**Resposta:** O Reflexo Miot√°tico √© ativado pelo **estiramento** do fuso muscular e causa a **contra√ß√£o** do m√∫sculo agonista (ex: reflexo patelar). O Reflexo Miot√°tico Inverso √© ativado pela **tens√£o/for√ßa** excessiva no √ìrg√£o Tendinoso de Golgi e causa o **relaxamento** do m√∫sculo para prote√ß√£o.', tema: 'cat1' },
                    { id: 2, pergunta: 'Explique o papel do Cerebelo como um "comparador" no controle motor.', gabarito: '**Resposta:** O cerebelo recebe informa√ß√µes sobre a **inten√ß√£o** do movimento (do c√≥rtex) e sobre a **execu√ß√£o** real (da periferia/medula). **Contexto:** Ele compara esses dois sinais e, se houver erro (discrep√¢ncia), envia corre√ß√µes para o sistema motor para ajustar a trajet√≥ria e garantir a coordena√ß√£o.', tema: 'cat1' },
                    { id: 3, pergunta: 'Descreva a fisiopatologia b√°sica da Doen√ßa de Parkinson relacionando-a com a via direta e indireta dos n√∫cleos da base.', gabarito: '**Resposta:** H√° degenera√ß√£o dos neur√¥nios dopamin√©rgicos da Subst√¢ncia Negra (Pars Compacta). **Contexto:** A falta de dopamina reduz a atividade da via **direta** (que facilita movimento) e aumenta a atividade da via **indireta** (que inibe movimento), resultando em hipocinesia (dificuldade de iniciar movimentos) e rigidez.', tema: 'cat1' },
                    { id: 4, pergunta: 'O que √© uma Unidade Motora e como ela se relaciona com a for√ßa de contra√ß√£o?', gabarito: '**Resposta:** Uma unidade motora √© composta por um neur√¥nio motor alfa e todas as fibras musculares que ele inerva. **Contexto:** Para aumentar a for√ßa (recrutamento), o sistema nervoso ativa mais unidades motoras ou aumenta a frequ√™ncia de disparo dessas unidades.', tema: 'cat1' },
                    { id: 5, pergunta: 'Compare a rigidez de descerebra√ß√£o com a rigidez de decortica√ß√£o em termos de n√≠vel de les√£o.', gabarito: '**Resposta:** A rigidez de **decortica√ß√£o** (flex√£o dos membros superiores) ocorre em les√µes acima do n√∫cleo rubro (c√≥rtex/capsula interna). **Contexto:** A rigidez de **descerebra√ß√£o** (extens√£o dos quatro membros) ocorre em les√µes abaixo do n√∫cleo rubro (mesenc√©falo/ponte), liberando os reflexos extensores vestibulares.', tema: 'cat1' },
                ]
            },
            'cat2': {
                nome: 'Fun√ß√µes Integrativas: Mem√≥ria, Sono e Emo√ß√µes',
                cor: 'green',
                fechadas: [
                    { id: 11, pergunta: 'O famoso paciente H.M., que teve o hipocampo removido bilateralmente, apresentou qual tipo de d√©ficit?', opcoes: ['Amn√©sia retr√≥grada completa.', 'Perda de mem√≥ria de procedimento (impl√≠cita).', 'Amn√©sia anter√≥grada severa (incapacidade de formar novas mem√≥rias expl√≠citas).', 'Perda da capacidade de sentir medo.'], correta: 2, tema: 'cat2' },
                    { id: 12, pergunta: 'Qual frequ√™ncia de onda no EEG √© caracter√≠stica de um estado de vig√≠lia atenta e concentra√ß√£o?', opcoes: ['Delta (< 4 Hz).', 'Theta (4-7 Hz).', 'Alpha (8-13 Hz).', 'Beta (15-30 Hz).'], correta: 3, tema: 'cat2' },
                    { id: 13, pergunta: 'O sono REM (Paradoxal) √© caracterizado por:', opcoes: ['Ondas lentas e de alta amplitude no EEG.', 'Atonia muscular (paralisia), movimentos oculares r√°pidos e EEG dessincronizado (similar √† vig√≠lia).', 'Aus√™ncia de sonhos.', 'Frequ√™ncia card√≠aca e respirat√≥ria muito est√°veis.'], correta: 1, tema: 'cat2' },
                    { id: 14, pergunta: 'Qual estrutura √© considerada o "centro do medo" e √© essencial para o condicionamento aversivo?', opcoes: ['Hipocampo.', 'C√≥rtex Pr√©-frontal.', 'Am√≠gdala.', 'Cerebelo.'], correta: 2, tema: 'cat2' },
                    { id: 15, pergunta: 'O sistema de recompensa cerebral, fundamental na motiva√ß√£o e no v√≠cio, utiliza principalmente qual neurotransmissor?', opcoes: ['Serotonina.', 'Dopamina.', 'Acetilcolina.', 'GABA.'], correta: 1, tema: 'cat2' },
                    { id: 16, pergunta: 'Qual estrutura atua como o "rel√≥gio biol√≥gico" mestre, regulando os ritmos circadianos?', opcoes: ['N√∫cleo Supraquiasm√°tico (NSQ) do hipot√°lamo.', 'Gl√¢ndula Pineal.', 'Forma√ß√£o Reticular.', 'T√°lamo.'], correta: 0, tema: 'cat2' },
                    { id: 17, pergunta: 'A mem√≥ria de procedimentos (como andar de bicicleta ou tocar um instrumento) √© um exemplo de:', opcoes: ['Mem√≥ria Expl√≠cita (Declarativa).', 'Mem√≥ria Epis√≥dica.', 'Mem√≥ria Impl√≠cita (N√£o-declarativa).', 'Mem√≥ria Sem√¢ntica.'], correta: 2, tema: 'cat2' },
                    { id: 18, pergunta: 'A Doen√ßa de Urbach-Wiethe, que causa calcifica√ß√£o bilateral da am√≠gdala, resulta em:', opcoes: ['Incapacidade de reconhecer faces (prosopagnosia).', 'Perda severa de mem√≥ria.', 'Incapacidade espec√≠fica de reconhecer e sentir medo.', 'Hifagia (fome excessiva).'], correta: 2, tema: 'cat2' },
                    { id: 19, pergunta: 'Qual o papel da melatonina no ciclo sono-vig√≠lia?', opcoes: ['Induzir o despertar.', 'Sinalizar a escurid√£o e preparar o corpo para o sono.', 'Inibir o sono REM.', 'Aumentar a temperatura corporal.'], correta: 1, tema: 'cat2' },
                    { id: 20, pergunta: 'A via mesol√≠mbica conecta a √Årea Tegmentar Ventral (VTA) a qual estrutura principal no sistema de recompensa?', opcoes: ['Hipocampo.', 'C√≥rtex Visual.', 'N√∫cleo Accumbens.', 'Cerebelo.'], correta: 2, tema: 'cat2' },
                ],
                abertas: [
                    { id: 6, pergunta: 'Diferencie Mem√≥ria Expl√≠cita (Declarativa) de Mem√≥ria Impl√≠cita (N√£o-declarativa) e cite as estruturas cerebrais principais de cada uma.', gabarito: '**Resposta:** Expl√≠cita: Fatos e eventos (epis√≥dica/sem√¢ntica), acesso consciente. Depende do **lobo temporal medial/hipocampo**. **Contexto:** Impl√≠cita: Habilidades motoras, h√°bitos, condicionamento. Depende de **n√∫cleos da base, cerebelo e am√≠gdala**.', tema: 'cat2' },
                    { id: 7, pergunta: 'Explique o conceito de "consolida√ß√£o" da mem√≥ria.', gabarito: '**Resposta:** √â o processo pelo qual uma mem√≥ria de curta dura√ß√£o (l√°bil) √© estabilizada em uma mem√≥ria de longa dura√ß√£o (est√°vel/engrama). **Contexto:** Envolve altera√ß√µes sin√°pticas (como LTP) e s√≠ntese proteica. O hipocampo √© crucial para consolidar mem√≥rias declarativas no c√≥rtex.', tema: 'cat2' },
                    { id: 8, pergunta: 'Descreva as principais caracter√≠sticas fisiol√≥gicas do Sono de Ondas Lentas (N3/Profundo) comparado ao Sono REM.', gabarito: '**Resposta:** N3 (Ondas Lentas): EEG sincronizado (ondas delta), t√¥nus muscular reduzido (mas presente), metabolismo baixo, essencial para recupera√ß√£o f√≠sica. **Contexto:** REM: EEG dessincronizado (r√°pido), atonia muscular completa (exceto olhos/respirat√≥rios), sonhos v√≠vidos, essencial para mem√≥ria e emocional.', tema: 'cat2' },
                    { id: 9, pergunta: 'Qual a rela√ß√£o entre a am√≠gdala e o hipocampo na forma√ß√£o de mem√≥rias emocionais?', gabarito: '**Resposta:** A am√≠gdala avalia a val√™ncia emocional (ex: perigo) e modula a consolida√ß√£o da mem√≥ria. **Contexto:** O hipocampo registra o contexto (onde/quando). A ativa√ß√£o da am√≠gdala fortalece a mem√≥ria no hipocampo, tornando eventos emocionais mais inesquec√≠veis.', tema: 'cat2' },
                    { id: 10, pergunta: 'Como drogas de abuso (ex: coca√≠na) atuam no sistema de recompensa?', gabarito: '**Resposta:** Elas aumentam artificialmente os n√≠veis de **dopamina** no N√∫cleo Accumbens (na via mesol√≠mbica). **Contexto:** A coca√≠na, por exemplo, bloqueia a recapta√ß√£o de dopamina, prolongando seu efeito e refor√ßando o comportamento de uso (v√≠cio).', tema: 'cat2' },
                ]
            },
            'cat3': {
                nome: 'SNA e C√≥rtices Associativos',
                cor: 'red',
                fechadas: [
                    { id: 21, pergunta: 'Qual √© o principal neurotransmissor liberado pelas fibras p√≥s-ganglionares do Sistema Nervoso Simp√°tico nos √≥rg√£os-alvo?', opcoes: ['Acetilcolina.', 'Noradrenalina.', 'Serotonina.', 'Glutamato.'], correta: 1, tema: 'cat3' },
                    { id: 22, pergunta: 'Os receptores nos √≥rg√£os-alvo do Sistema Nervoso Parassimp√°tico s√£o do tipo:', opcoes: ['Nicot√≠nicos.', 'Adren√©rgicos Alfa.', 'Adren√©rgicos Beta.', 'Muscar√≠nicos.'], correta: 3, tema: 'cat3' },
                    { id: 23, pergunta: 'O c√≥rtex de associa√ß√£o parietal √© fundamental para:', opcoes: ['Planejamento motor.', 'Reconhecimento de objetos (O que √©?).', 'Aten√ß√£o e percep√ß√£o espacial (Onde est√°?).', 'Controle emocional.'], correta: 2, tema: 'cat3' },
                    { id: 24, pergunta: 'A Prosopagnosia (incapacidade de reconhecer faces) √© causada por les√£o em qual √°rea?', opcoes: ['C√≥rtex Pr√©-frontal.', 'Lobo Parietal Direito (Neglig√™ncia).', 'C√≥rtex Temporal Inferior (√Årea fusiforme da face).', '√Årea de Broca.'], correta: 2, tema: 'cat3' },
                    { id: 25, pergunta: 'O caso de Phineas Gage, que teve mudan√ßa dr√°stica de personalidade e perda de inibi√ß√£o social, ilustra a fun√ß√£o de qual √°rea?', opcoes: ['C√≥rtex Pr√©-frontal (Associa√ß√£o Frontal).', 'C√≥rtex Occipital.', 'Hipocampo.', 'Cerebelo.'], correta: 0, tema: 'cat3' },
                    { id: 26, pergunta: 'A S√≠ndrome de Neglig√™ncia Unilateral (ignorar metade do espa√ßo/corpo) geralmente ocorre ap√≥s les√£o em qual lobo?', opcoes: ['Lobo Frontal Esquerdo.', 'Lobo Parietal Direito.', 'Lobo Temporal Bilateral.', 'Lobo Occipital.'], correta: 1, tema: 'cat3' },
                    { id: 27, pergunta: 'Qual divis√£o do SNA √© conhecida como sistema de "luta ou fuga" (catab√≥lico)?', opcoes: ['Simp√°tico.', 'Parassimp√°tico.', 'Ent√©rico.', 'Som√°tico.'], correta: 0, tema: 'cat3' },
                    { id: 28, pergunta: 'A medula da adrenal √© considerada um g√¢nglio modificado de qual sistema?', opcoes: ['Parassimp√°tico.', 'Simp√°tico.', 'Som√°tico.', 'L√≠mbico.'], correta: 1, tema: 'cat3' },
                    { id: 29, pergunta: 'Onde se localizam os corpos celulares dos neur√¥nios pr√©-ganglionares do sistema Parassimp√°tico?', opcoes: ['Medula espinhal toracolombar (T1-L2).', 'Tronco encef√°lico e medula sacral (Craniossacral).', 'G√¢nglios paravertebrais.', 'C√≥rtex motor.'], correta: 1, tema: 'cat3' },
                    { id: 30, pergunta: 'A √Årea de Broca, relacionada √† produ√ß√£o da fala, est√° localizada tipicamente no:', opcoes: ['Lobo Temporal Superior.', 'Lobo Frontal Inferior.', 'Lobo Parietal.', 'Lobo Occipital.'], correta: 1, tema: 'cat3' },
                ],
                abertas: [
                    { id: 11, pergunta: 'Compare os efeitos do Sistema Simp√°tico e Parassimp√°tico no cora√ß√£o e na pupila.', gabarito: '**Resposta:** Cora√ß√£o: Simp√°tico aumenta a frequ√™ncia (taquicardia, receptor Beta-1); Parassimp√°tico diminui (bradicardia, receptor Muscar√≠nico). **Contexto:** Pupila: Simp√°tico dilata (midr√≠ase, receptor Alfa); Parassimp√°tico contrai (miose, receptor Muscar√≠nico).', tema: 'cat3' },
                    { id: 12, pergunta: 'Explique o mecanismo da febre em termos de termorregula√ß√£o hipotal√¢mica.', gabarito: '**Resposta:** Pirog√™nios (ex: citocinas) alteram o "ponto de ajuste" (set point) do termostato no hipot√°lamo para uma temperatura mais alta. **Contexto:** O corpo ent√£o ativa mecanismos de conserva√ß√£o/produ√ß√£o de calor (tremores, vasoconstri√ß√£o) at√© atingir essa nova temperatura elevada.', tema: 'cat3' },
                    { id: 13, pergunta: 'Qual a fun√ß√£o do C√≥rtex Pr√©-Frontal no comportamento executivo e tomada de decis√£o?', gabarito: '**Resposta:** √â respons√°vel pelo planejamento, estrat√©gia, inibi√ß√£o de comportamentos inadequados, mem√≥ria de trabalho e julgamento moral. **Contexto:** Ele avalia as consequ√™ncias futuras das a√ß√µes, permitindo o controle sobre impulsos emocionais (top-down).', tema: 'cat3' },
                    { id: 14, pergunta: 'O que √© a Afasia de Wernicke e como ela difere da Afasia de Broca?', gabarito: '**Resposta:** Afasia de Wernicke (sensorial) afeta a **compreens√£o**; a fala √© fluente mas sem sentido ("salada de palavras"). **Contexto:** Afasia de Broca (motora) afeta a **produ√ß√£o**; a compreens√£o √© preservada, mas a fala √© dif√≠cil, lenta e n√£o fluente.', tema: 'cat3' },
                    { id: 15, pergunta: 'Como ocorre a termorregula√ß√£o em um ambiente quente (perda de calor)?', gabarito: '**Resposta:** O hipot√°lamo detecta o aumento de temperatura e ativa mecanismos de perda de calor. **Contexto:** Ocorre **vasodilata√ß√£o cut√¢nea** (para irradiar calor) e estimula√ß√£o das **gl√¢ndulas sudor√≠paras** (suor) para resfriamento por evapora√ß√£o (via simp√°tica colin√©rgica).', tema: 'cat3' },
                ]
            }
        };

        // --- Vari√°veis de Estado ---
        let allClosedQuestions = []; 
        let allOpenQuestions = []; 
        let respostasFechadas = {};
        let respostasAbertas = [];
        let resultadosFechadas = null;
        let verificadas = false;
        let abertasVerificadas = false;
        let tempoRestante = 5400; // 1 hora e 30 minutos
        let timerId = null;
        let timeIsUp = false;

        // --- FUN√á√ïES DE L√ìGICA ---

        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex !== 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [
                    array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        function formatTime(totalSeconds) {
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function getOptionClass(q, index) {
            if (!verificadas) {
                return respostasFechadas[q.id] === index ? 'bg-blue-200 border-blue-600' : 'hover:bg-gray-100 border-gray-300';
            }
            if (index === q.correta) {
                return 'bg-green-100 border-green-600 font-bold';
            } else if (respostasFechadas[q.id] === index) {
                return 'bg-red-100 border-red-600 line-through';
            } else {
                return 'bg-white border-gray-300';
            }
        }

        function getResumoPorTema() {
            if (!verificadas) return {};
            const temas = {};
            Object.keys(FULL_POOLS).forEach(key => {
                temas[key] = { acertos: 0, total: 0, nome: FULL_POOLS[key].nome, cor: FULL_POOLS[key].cor };
            });
            allClosedQuestions.forEach(q => {
                const temaKey = q.tema;
                temas[temaKey].total++;
                if (respostasFechadas[q.id] === q.correta) {
                    temas[temaKey].acertos++;
                }
            });
            return temas;
        }

        // --- FUN√á√ïES DE RENDERIZA√á√ÉO ---

        function renderHeader() {
            const container = document.getElementById('header-container');
            const timerClass = timeIsUp ? 'bg-red-600 text-white time-up' : 'bg-slate-700';

            container.innerHTML = `
                <header class="bg-slate-800 text-white p-6 rounded-xl shadow-2xl mb-8 flex flex-col sm:flex-row justify-between items-center gap-4">
                    <div class="flex items-center gap-4">
                        <span class="w-8 h-8 text-blue-400 text-3xl">üß†</span>
                        <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">
                            Simulado de Neurofisiologia e Fun√ß√µes Corticais
                        </h1>
                    </div>
                    <div class="flex items-center gap-6">
                        <div id="timer-display" class="flex items-center gap-2 p-2 rounded-lg ${timerClass}">
                            <span class="w-5 h-5 text-yellow-400">‚è≥</span>
                            <span class="font-mono text-lg">${formatTime(tempoRestante)}</span>
                        </div>
                        <div class="flex items-center gap-2 bg-slate-700 p-2 rounded-lg">
                            <span class="w-5 h-5 text-red-400">üìä</span>
                            <span class="font-semibold text-lg">${allClosedQuestions.length + allOpenQuestions.length} Quest√µes</span>
                        </div>
                    </div>
                </header>
            `;
        }

        function renderResultsSummary() {
            const container = document.getElementById('results-summary');
            if (!verificadas || !resultadosFechadas) {
                container.innerHTML = '';
                return;
            }

            const resumoPorTema = getResumoPorTema();
            let temaHtml = '';
            
            Object.values(resumoPorTema).forEach(tema => {
                const percentage = tema.total > 0 ? ((tema.acertos / tema.total) * 100).toFixed(0) : 0;
                temaHtml += `
                    <div class="flex justify-between items-center bg-slate-50 p-3 rounded-md">
                        <div class="flex items-center gap-2">
                            <span class="w-4 h-4 text-${tema.cor}-500">üè∑Ô∏è</span>
                            <span class="text-sm font-medium text-slate-600">${tema.nome}</span>
                        </div>
                        <span class="font-bold text-md text-${tema.cor}-700">${tema.acertos} / ${tema.total} (${percentage}%)</span>
                    </div>
                `;
            });

            container.innerHTML = `
                <section class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-green-500 mb-8">
                    <h2 class="text-2xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <span class="w-6 h-6 text-green-600">‚úÖ</span> Resumo de Desempenho (M√∫ltipla Escolha)
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="p-4 bg-green-50 rounded-lg border border-green-200">
                            <p class="text-xl font-bold text-green-700">${resultadosFechadas.acertos}</p>
                            <p class="text-sm text-green-600">Acertos</p>
                        </div>
                        <div class="p-4 bg-red-50 rounded-lg border border-red-200">
                            <p class="text-xl font-bold text-red-700">${resultadosFechadas.incorretos}</p>
                            <p class="text-sm text-red-600">Erros</p>
                        </div>
                        <div class="p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                            <p class="text-xl font-bold text-yellow-700">${resultadosFechadas.naoRespondidas}</p>
                            <p class="text-sm text-yellow-600">N√£o Respondidas</p>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mb-3">Acertos por Categoria:</h3>
                    <div class="space-y-2">
                        ${temaHtml}
                    </div>
                </section>
            `;
        }

        function renderClosedQuestions() {
            const container = document.getElementById('closed-questions-section');
            let closedHtml = `
                <h2 class="text-3xl font-bold text-slate-700 border-b-2 border-slate-300 pb-2 mb-8 flex items-center gap-2">
                    <span class="w-7 h-7 text-blue-600">‚òëÔ∏è</span> Parte A: 15 Quest√µes de M√∫ltipla Escolha
                </h2>
            `;
            let globalQuestionIndex = 0;

            Object.keys(FULL_POOLS).forEach(tagKey => {
                const temaData = FULL_POOLS[tagKey];
                const questionsForTag = allClosedQuestions.filter(q => q.tema === tagKey);
                
                closedHtml += `
                    <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-${temaData.cor}-500">
                        <h3 class="text-2xl font-bold text-${temaData.cor}-700 mb-6 flex items-center gap-3">
                            <span class="w-6 h-6 text-${temaData.cor}-600">üè∑Ô∏è</span> ${temaData.nome}
                        </h3>
                        <div class="space-y-6">
                `;

                questionsForTag.forEach((q) => {
                    globalQuestionIndex++;
                    let optionsHtml = '';
                    q.opcoes.forEach((opcao, index) => {
                        const isDisabled = verificadas ? 'disabled' : '';
                        const optionClass = getOptionClass(q, index);
                        const correctBadge = (verificadas && index === q.correta) ? '<span class="ml-3 text-green-700 font-bold flex-shrink-0"> (Correta)</span>' : '';
                        const cursorClass = verificadas || timeIsUp ? 'cursor-not-allowed' : 'cursor-pointer';

                        optionsHtml += `
                            <button
                                onclick="handleRespostaFechada(${q.id}, ${index})"
                                ${isDisabled}
                                class="w-full text-left p-3 rounded-lg border-2 transition-all duration-200 ${optionClass} ${cursorClass}"
                            >
                                <span class="font-mono font-bold mr-2 text-slate-600">${String.fromCharCode(65 + index)}.</span>
                                <span class="text-slate-700">${opcao}</span>
                                ${correctBadge}
                            </button>
                        `;
                    });

                    closedHtml += `
                        <div id="q-closed-${q.id}" class="p-4 border-b border-slate-100 last:border-b-0">
                            <p class="text-lg font-semibold text-slate-800 mb-3">
                                <span class="text-${temaData.cor}-600 mr-2">${globalQuestionIndex}.</span> ${q.pergunta}
                            </p>
                            <div class="space-y-2">
                                ${optionsHtml}
                            </div>
                        </div>
                    `;
                });

                closedHtml += `
                        </div>
                    </div>
                `;
            });

            const buttonHtml = !verificadas ? `
                <button
                    onclick="handleVerificar()"
                    ${timeIsUp ? 'disabled' : ''}
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg flex items-center gap-2 transition-colors ${timeIsUp ? 'opacity-50 cursor-not-allowed' : ''}"
                >
                    <span class="w-5 h-5">‚ö°</span> Finalizar e Verificar Respostas
                </button>
            ` : `
                <div class="px-6 py-3 bg-slate-400 text-white font-bold rounded-lg cursor-not-allowed">
                    Verificado
                </div>
            `;

            closedHtml += `
                <div class="bg-slate-200 p-6 rounded-xl border border-slate-300 flex flex-col sm:flex-row justify-between items-center gap-4 mt-6">
                    <div>
                        <h3 class="font-bold text-slate-800 text-lg">Fim da Parte A</h3>
                        <p class="text-sm text-slate-600">Verifique suas respostas para a corre√ß√£o autom√°tica.</p>
                    </div>
                    ${buttonHtml}
                </div>
            `;
            container.innerHTML = closedHtml;
        }

        function renderOpenQuestions() {
            const container = document.getElementById('open-questions-section');
            let openHtml = `
                <h2 class="text-3xl font-bold text-slate-700 border-b-2 border-slate-300 pb-2 mb-8 flex items-center gap-2">
                    <span class="w-7 h-7 text-orange-600">üìù</span> Parte B: 15 Quest√µes Discursivas
                </h2>
            `;
            let globalQuestionIndex = allClosedQuestions.length;

            allOpenQuestions.forEach((q) => {
                globalQuestionIndex++;
                const temaData = FULL_POOLS[q.tema];
                const colorClass = `border-l-4 border-${temaData.cor}-500`;

                const gabaritoHtml = abertasVerificadas ? `
                    <div class="mt-4 p-4 bg-green-50 rounded-lg text-slate-800 text-sm border border-green-200">
                        <strong class="text-green-700 block mb-1">Gabarito / Contexto Esperado:</strong>
                        ${q.gabarito.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}
                    </div>
                ` : '';

                openHtml += `
                    <div class="bg-white p-6 rounded-xl shadow-md border ${colorClass}">
                        <p class="text-xl font-semibold text-slate-800 mb-4">
                            <span class="text-${temaData.cor}-600 mr-2">${globalQuestionIndex}.</span> ${q.pergunta}
                        </p>
                        <p class="text-xs font-medium text-slate-500 mb-2 flex items-center gap-1"><span class="w-4 h-4">üè∑Ô∏è</span> Tema: ${temaData.nome}</p>
                        <textarea
                            rows="5"
                            oninput="handleRespostaAberta(${q.id}, this.value)"
                            ${abertasVerificadas ? 'disabled' : ''}
                            class="w-full p-3 border border-slate-300 rounded-lg focus:ring-orange-500 focus:border-orange-500 text-slate-700 resize-none ${abertasVerificadas ? 'bg-gray-100 disabled-textarea' : ''}"
                            placeholder="Escreva sua resposta aqui..."
                        >${q.resposta}</textarea>
                        ${gabaritoHtml}
                    </div>
                `;
            });

            const buttonHtml = !abertasVerificadas ? `
                <button
                    onclick="handleLiberarGabaritosAbertas()"
                    class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg flex items-center gap-2 transition-colors"
                >
                    <span class="w-5 h-5">üëÅÔ∏è</span> Liberar Gabaritos das 15 Quest√µes
                </button>
            ` : `
                <div class="px-6 py-3 bg-slate-400 text-white font-bold rounded-lg cursor-not-allowed">
                    Gabaritos Liberados
                </div>
            `;

            openHtml += `
                <div class="bg-slate-200 p-6 rounded-xl border border-slate-300 flex flex-col sm:flex-row justify-between items-center gap-4 mt-6">
                    <div>
                        <h3 class="font-bold text-slate-800 text-lg">Fim da Parte B</h3>
                        <p class="text-sm text-slate-600">Compare suas respostas com os gabaritos sugeridos.</p>
                    </div>
                    ${buttonHtml}
                </div>
            `;
            container.innerHTML = openHtml;
        }

        function renderFooter() {
            const container = document.getElementById('footer-container');
            container.innerHTML = `
                <footer class="mt-10 pt-6 border-t border-slate-300 text-center text-sm text-slate-500">
                    <p>Simulado de Neurofisiologia - Aplica√ß√£o em JavaScript Vanilla (Puro) e Tailwind CSS.</p>
                </footer>
            `;
        }

        function renderApp() {
            renderHeader();
            renderResultsSummary();
            renderClosedQuestions();
            renderOpenQuestions();
            renderFooter();
        }

        // --- EVENTOS ---

        function handleRespostaFechada(id, index) {
            if (verificadas || timeIsUp) return;
            respostasFechadas[id] = index;
            renderClosedQuestions();
        }
        window.handleRespostaFechada = handleRespostaFechada;

        function handleRespostaAberta(id, value) {
            const q = allOpenQuestions.find(q => q.id === id);
            if (q) {
                q.resposta = value;
            }
        }
        window.handleRespostaAberta = handleRespostaAberta;

        function handleVerificar() {
            if (verificadas) return;
            clearInterval(timerId);
            verificadas = true;

            let acertos = 0;
            let incorretos = 0;
            const totalQuestoes = allClosedQuestions.length;

            allClosedQuestions.forEach(q => {
                const respostaUsuario = respostasFechadas[q.id];
                if (respostaUsuario === q.correta) {
                    acertos++;
                } else if (respostaUsuario !== undefined) {
                    incorretos++;
                }
            });

            resultadosFechadas = { acertos, incorretos, naoRespondidas: totalQuestoes - acertos - incorretos };
            renderApp();
        }
        window.handleVerificar = handleVerificar;

        function handleLiberarGabaritosAbertas() {
            if (abertasVerificadas) return;
            abertasVerificadas = true;
            renderOpenQuestions();
        }
        window.handleLiberarGabaritosAbertas = handleLiberarGabaritosAbertas;

        // --- INICIALIZA√á√ÉO ---

        function initializeQuestions() {
            allClosedQuestions = [];
            allOpenQuestions = [];

            Object.keys(FULL_POOLS).forEach(key => {
                const pool = FULL_POOLS[key];
                
                // Seleciona 5 fechadas aleatoriamente
                const closedPool = shuffle([...pool.fechadas]);
                const selectedClosed = closedPool.slice(0, 5);
                allClosedQuestions.push(...selectedClosed);
                
                // Seleciona 5 abertas aleatoriamente
                const openPool = shuffle([...pool.abertas]);
                const selectedOpen = openPool.slice(0, 5);
                allOpenQuestions.push(...selectedOpen.map(q => ({...q, resposta: ''}))); 
            });
            
            // Embaralhar ordem final
            allClosedQuestions = shuffle(allClosedQuestions);
            allOpenQuestions = shuffle(allOpenQuestions);

            respostasFechadas = {};
        }

        function startTimer() {
            const timerDisplayContainer = document.getElementById('timer-display');
            
            function updateTimer() {
                if (tempoRestante <= 0) {
                    clearInterval(timerId);
                    tempoRestante = 0;
                    timeIsUp = true;
                    if (!verificadas) {
                       handleVerificar(); 
                    } else {
                       renderHeader();
                       renderClosedQuestions();
                    }
                    return;
                }
                // Atualiza apenas o texto do timer se ele existir no DOM
                const timerSpan = document.querySelector('#timer-display span:last-child');
                 if (timerSpan) {
                    timerSpan.textContent = formatTime(tempoRestante);
                    if (tempoRestante <= 300 && !document.querySelector('.time-up')) {
                        const timerDiv = document.getElementById('timer-display');
                        timerDiv.classList.remove('bg-slate-700');
                        timerDiv.classList.add('bg-red-600', 'time-up');
                    }
                }
                tempoRestante--;
            }

            if (timerId) clearInterval(timerId);
            timerId = setInterval(updateTimer, 1000);
        }

        window.onload = function() {
            initializeQuestions();
            renderApp();
            startTimer();
        };
    </script>
</body>
</html>
